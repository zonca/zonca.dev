<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2017-09-06">

<title>Andrea Zonca - Setup automated testing on a Github repository with Travis-ci</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Andrea Zonca</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zonca"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/andreazonca"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Setup automated testing on a Github repository with Travis-ci</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">github</div>
                <div class="quarto-category">git</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 6, 2017</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>It is good practice in software development to implement extensive testing of the codebase in order to catch quickly any bug introduced into the code when implementing new features.</p>
<p>The suite of tests should be easy to execute (possibly one single command, for example with the <code>py.test</code> runner) and quick to run (more than 1 minute would make it tedious to run).</p>
<p>The developers should run the unit test suite every time they implement a change to the codebase to make sure anything else has not been broken.</p>
<p>However, once a commit has been pushed to Github, it is also useful to have automated testing executed automatically, at least for 2 reasons:</p>
<ul>
<li>Run tests in all the environments that need to be supported by the software, for example run with different versions of Python or different versions of a key required external dependancy</li>
<li>Run tests in a clean environment that has less risks of being contaminated by some mis-configuration on one of the developers’ environments</li>
</ul>
</section>
<section id="travis-ci" class="level2">
<h2 class="anchored" data-anchor-id="travis-ci">Travis-CI</h2>
<p>Travis is a free web based service that allows to register a trigger on Github so that every time a commit is pushed to Github or a Pull Request is opened, it launches an isolated Ubuntu (even if it also supports Mac OS) container for each of the configurations that we want to test, builds the software (if needed) and then runs the test.</p>
<p>The only requirement is that the Github project needs to be public for the free service. Otherwise there are paid plans for private repositories.</p>
</section>
<section id="setup-on-travis-ci" class="level2">
<h2 class="anchored" data-anchor-id="setup-on-travis-ci">Setup on Travis-CI</h2>
<ul>
<li>Go to <a href="http://travis-ci.org" class="uri">http://travis-ci.org</a> and login with a Github account</li>
<li>In order to automatatically configure the hook on Github, Travis requests writing privileges to your Github account, annoying but convenient</li>
<li>Leave all default options, just make sure that Pull Requests are automatically tested</li>
<li>If you have the repository both under an organization and a fork under your account, you can choose either to test both or just the organization repository, anyway your pull requests will be tested before merging.</li>
</ul>
</section>
<section id="preparation-of-the-test-scripts" class="level2">
<h2 class="anchored" data-anchor-id="preparation-of-the-test-scripts">Preparation of the test scripts</h2>
<p>In order to automate running the test scripts on Travis-CI, it is important that the test scripts return a exit code different from zero to signal that the tests failed.</p>
<p>If you are using a test running tool like <code>pytest</code>, this is automatically done for you. If you are using bash scripts instead, make sure that if the script detects an error it calls <code>exit 1</code>. In order to automate running the test scripts on Travis-CI, it is important that the test scripts return a exit code different from zero to signal that the tests failed.</p>
<p>If you are using a test running tool like <code>pytest</code>, this is automatically done for you. If you are using bash scripts instead, make sure that if the script detects an error it calls <code>exit 1</code>.</p>
</section>
<section id="configuration-of-the-repository" class="level2">
<h2 class="anchored" data-anchor-id="configuration-of-the-repository">Configuration of the repository</h2>
<ul>
<li><p>Create a new branch on your repository:</p>
<pre><code>  git checkout -b test_travis</code></pre></li>
<li><p>Add a <code>.travis.yml</code> (mind that it starts with a dot) configuration file</p></li>
<li><p>Inside this file you can configure how your project is built and tested, for the simple case of <code>bash</code> or <code>perl</code> scripts you can just write:</p>
<pre><code>  dist: trusty
  language: bash

  script:
      - cd $TRAVIS_BUILD_DIR/tests; bash run_test.sh</code></pre></li>
<li><p>Check the Travis-CI documentation for advanced configuration options</p></li>
<li><p>Now push these changes to your fork of the main repository and then create a Pull Request to the main repository</p></li>
<li><p>Go to <a href="https://travis-ci.org/YOUR_ORGANIZATION/YOUR_REPO" class="uri">https://travis-ci.org/YOUR_ORGANIZATION/YOUR_REPO</a> to check the build status and the log</p></li>
<li><p>Once your Pull Request passes the tests, merge it to the main repository so that also the master branch will be tested for all future commits.</p></li>
</ul>
</section>
<section id="python-example" class="level2">
<h2 class="anchored" data-anchor-id="python-example">Python example</h2>
<p>In the following example, Travis-CI will create 8 builds, each of the 4 versions of Python will be tested with the 2 versions of <code>numpy</code>:</p>
<pre><code>language: python
python:
  - "2.7"
  - "3.4"
  - "3.5"
  - "3.6"
env:
  - NUMPY_VERSION=1.12.1
  - NUMPY_VERSION=1.13.1
# command to install dependencies, requirements.txt should NOT include numpy
install:
  - pip install -r requirements.txt numpy==$NUMPY_VERSION
# command to run tests
script:
  - pytest # or py.test for Python versions 3.5 and below</code></pre>
</section>
<section id="badge-in-readme" class="level2">
<h2 class="anchored" data-anchor-id="badge-in-readme">Badge in README</h2>
<p>Aestetic touch, left click on the “Build Passing” image on the Travis-CI page for your repository, choose “Markdown” and paste the code to the <code>README.md</code> of your repository on Github. This will show in real time if the last version of the code is passing the tests or not.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>