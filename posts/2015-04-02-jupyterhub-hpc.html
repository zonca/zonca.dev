<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2015-04-02">

<title>Andrea Zonca - Run Jupyterhub on a Supercomputer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Andrea Zonca</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../consult.html">Consulting</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zonca"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/andreazonca"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Run Jupyterhub on a Supercomputer</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">jupyterhub</div>
                <div class="quarto-category">hpc</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 2, 2015</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<blockquote class="blockquote">
<p><strong>Summary</strong>: I developed a plugin for <a href="https://github.com/jupyter/jupyterhub" title="jupyterhub">Jupyterhub</a>: <a href="https://github.com/zonca/remotespawner">RemoteSpawner</a>, it has a proof-of-concept interface with the Supercomputer Gordon at UC San Diego to spawn IPython Notebook instances as jobs throught the queue and tunnel the interface back to the Jupyterhub instance.</p>
</blockquote>
<p>The IPython (recently renamed Jupyter) Notebook is a powerful tool for analyzing and visualizing data in Python and other programming languages. A key feature is that a single document contains code, figures, text and equations. Everything is saved in a single .ipynb file that can be shared, executed and modified. See an <a href="http://nbviewer.ipython.org/github/waltherg/notebooks/blob/master/2013-12-03-Crank_Nicolson.ipynb" title="example notebook">example Notebook on integration of partial differential equations</a>.</p>
<p>The Jupyter Notebook is a Python application with a web frontend, i.e.&nbsp;the interface runs in the user browser. This setup makes it suitable for any kind of remote computing, in particular running the Jupyter Notebook on a computing node of a Supercomputer, and exporting the interface HTTP port to a local browser. Setting up tunneling via SSH is tedious, in particular if the user does not have a public IP address.</p>
<p><a href="https://github.com/jupyter/jupyterhub" title="jupyterhub">Jupyterhub</a>, developed by the Jupyter team, comes to the rescue by providing a web application that manages and proxies multiple instances of the Jupyter Notebook for any number of users. Jupyterhub natively only spawns local processes, but supports plugins to extend its functionality.</p>
<p>I have been developing a proof-of-concept plugin (<a href="https://github.com/zonca/remotespawner">RemoteSpawner</a>) designed to work on a web server and once a user is authenticated, connect to the login node of a Supercomputer and submit a Jupyter Notebook job. As soon as the job starts execution, it sets up SSH tunneling with the Jupyterhub host so that Jupyterhub can provide the Notebook interface to the user. This setup allows users to simply access a Supercomputer via browser, accessing all their Python environment and data.</p>
<p>I am looking for interested parties either as users or as collaborators to help further development. See more information about the project below.</p>
<section id="test-it-yourself" class="level2">
<h2 class="anchored" data-anchor-id="test-it-yourself">Test it yourself</h2>
<p>In order to have a feeling on how Jupyterhub works, you can test in your browser at:</p>
<ul>
<li><a href="http://tmpnb.org" class="uri">http://tmpnb.org</a></li>
</ul>
<p>This service by Rackspace creates temporary Jupyter Notebooks on the fly. If you click on <code>Welcome.ipynb</code>, you can see an example Notebook.</p>
<p>The purpose of my project is to have a web interface to access Jupyter Notebooks that are running on computing nodes of a Supercomputer. So that users can access the environment and data on a Supercomputer from their browser and run data-intensive processing.</p>
</section>
<section id="tour-of-jupyterhub-on-the-gordon-supercomputer" class="level2">
<h2 class="anchored" data-anchor-id="tour-of-jupyterhub-on-the-gordon-supercomputer">Tour of Jupyterhub on the Gordon Supercomputer</h2>
<p>Iâ€™ll show some screenshots to display how a test Jupyterhub installation on my machine is integrated with <a href="http://www.sdsc.edu/us/resources/gordon/">Gordon</a> thanks to the plugin.</p>
<p>Jupyterhub is accessed publicly via browser and the user can login. Jupyterhub supports authentication for <code>PAM</code>/<code>LDAP</code> so it could be integrated with XSEDE credential, at the moment I am testing with local authentication.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="jupyterhub-hpc-login.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">jupyterhub-hpc-login.png</figcaption><p></p>
</figure>
</div>
<p>Once the user is authenticated, Jupyterhub connects via <code>SSH</code> to a login node on Gordon and submits a batch serial job using <code>qsub</code>. The web interface waits for the job to start running. A dedicated queue with a quick turnaround would be useful for this kind of jobs.</p>
<p><img src="jupyterhub-hpc-refresh.png" class="img-fluid" alt="jupyterhub-hpc-refresh.png"> <img src="jupyterhub-hpc-job.png" class="img-fluid" alt="jupyterhub-hpc-job.png"></p>
<p>When the job starts running, it first sets up <code>SSH</code> tunneling between the Jupyterhub host and the computing node, then starts the Jupyter Notebook. As soon as the web interface detects that the job is running, proxies the tunneled HTTP port for the user. From this point the Jupyter Notebook works exactly like it would on a local machine.</p>
<p>See an example Notebook printing the hostname of the computing node:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="jupyterhub-hpc-testnotebook.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">jupyterhub-hpc-testnotebook.png</figcaption><p></p>
</figure>
</div>
<p>Other two useful features of the Jupyter Notebook are a terminal:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="jupyterhub-hpc-terminal.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">jupyterhub-hpc-terminal.png</figcaption><p></p>
</figure>
</div>
<p>and an editor that run in the browser:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="jupyterhub-hpc-editor.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">jupyterhub-hpc-editor.png</figcaption><p></p>
</figure>
</div>
</section>
<section id="launch-jupyterhub-parallel-to-access-hundreds-of-computing-engines" class="level2">
<h2 class="anchored" data-anchor-id="launch-jupyterhub-parallel-to-access-hundreds-of-computing-engines">Launch Jupyterhub parallel to access hundreds of computing engines</h2>
<p>The Notebook also supports using Torque to run Python computing engines and send them computationally intensive serial functions for load-balanced execution.</p>
<p>In the Notebook interface, in the <code>Clusters</code> tab, is it possible to choose the number of engines and click start to submit a job to the queue system:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="jupyterhub-hpc-clusterlaunch.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">jupyterhub-hpc-clusterlaunch.png</figcaption><p></p>
</figure>
</div>
<p>This will pack 16 jobs per node (Gordon has 16-cores CPUs) and make them available from the notebook, see an example usage where I process 1000 files with 128 engines running on a different job on Gordon:</p>
<ul>
<li><a href="http://nbviewer.ipython.org/gist/zonca/9bd94d8782af037704ff">Example of Jupyterhub Parallel</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>